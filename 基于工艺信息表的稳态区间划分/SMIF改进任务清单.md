# 任务清单 - SMIF稳态区间划分工具改进

## 阶段1：数据导入模块改进

### 1.1 CSV/TXT文件导入
- [ ] 添加文件浏览对话框，支持同时选择CSV和TXT文件
- [ ] 解析CSV文件格式（5列：电流、vgpro功率、边缘模块功率、行号、程序号）
- [ ] 解析TXT程序映射格式（程序名:程序号:刀具号:起始行-终止行）
- [ ] 实现数据预加载进度显示

### 1.2 数据源选择
- [ ] 添加数据源单选按钮组（电流/vgpro功率/边缘模块功率）
- [ ] 实现数据源切换逻辑
- [ ] 切换时更新可视化显示

### 1.3 程序/刀具选择器
- [ ] 实现程序下拉选择器
- [ ] 实现刀具下拉选择器（按TXT文件顺序，支持重复刀具号）
- [ ] 切换程序/刀具时自动加载对应数据

---

## 阶段2：P-s功率可视化与稳态区间划分

### 2.1 P-s曲线显示
- [ ] 修改现有MRR-s可视化为P-s功率曲线
- [ ] 保持原有的行号位置映射逻辑
- [ ] 适配三种数据源（电流、vgpro功率、边缘模块功率）

### 2.2 稳态区间划分算法
- [ ] **保留使用现有 `academic_smif_zs_v2.py` 的稳态区间划分算法**
- [ ] 将划分目标从 MRR 改为 P（功率）
- [ ] 保持现有的参数设置界面（波动阈值、最小区间长度等）

### 2.3 区间优化
- [ ] 保留区间合并/扩展功能
- [ ] 支持手动微调区间边界

---

## 阶段3：实测与仿真数据对齐显示

### 3.1 双曲线可视化
- [ ] 添加可视化模式切换（同图显示/分图显示）
- [ ] 实现同图叠加显示（实测P + 仿真P_pred）
- [ ] 实现分图对比显示（上下两图）

### 3.2 行号对齐逻辑
- [ ] 确保实测数据按程序行号索引
- [ ] 实现仿真数据与实测数据的行号映射
- [ ] 处理数据点数量不一致的情况

### 3.3 偏差可视化
- [ ] 显示 (P_pred - P_meas) / P_pred 偏差曲线
- [ ] 高亮显示偏差超阈值的区域

---

## 阶段4：阻抗自动更新

### 4.1 阻抗反解计算
- [ ] 实现单点阻抗计算：Z_j = (P_j - P_idle) / MRR_j
- [ ] 实现区间阻抗中值聚合：Z_hat = Median({Z_j})
- [ ] 实现保守上界计算：Z_UCB = Z_hat + β × σ_Z

### 4.2 阻抗场更新存储
- [ ] 将更新后的阻抗写入PIT工艺信息表
- [ ] 显示阻抗更新前后对比

### 4.3 执行环倍率计算
- [ ] 实现进给倍率更新公式：R_{i,N+1} = R_{i,N} × (1 + γ × δP/P_pred)
- [ ] 显示各区间的建议倍率调整值

---

## 阶段5：结果输出与集成

### 5.1 RG文件输出
- [ ] 实现`.rg`负载区间交互文件生成
- [ ] 格式：数据源标识 + 程序名;理想值;区间列表

### 5.2 报告导出
- [ ] 支持导出分析报告（含区间统计、阻抗更新记录）
- [ ] 支持导出可视化图表

### 5.3 集成测试
- [ ] 使用SampleData.csv + SampleData.txt进行完整流程测试
- [ ] 验证所有功能模块协同工作
- [ ] 检查输出文件格式正确性
